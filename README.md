## COVID‑19 Severity Phenotyping from Routine Blood Tests

This repository contains the full code, notebooks and documentation for a medical statistics project on COVID‑19 phenotyping. The goal is to derive clinically meaningful severity phenotypes from admission blood tests, validate them statistically and via supervised learning, and summarise the work in an 8‑page academic paper.

The project is organised around four main Jupyter notebooks (`notebooks/01`–`04`) that implement the end‑to‑end analysis pipeline, plus experimental notebooks under `experiments/` used for model comparison and feature screening.

### 1. Project structure

- `data/raw/` – original Einstein Data4u export (Excel/CSV; not tracked in Git).
- `data/processed/`
  - `01_cleaned_advanced.csv` – fully preprocessed cohort used as input to PCA and clustering.
  - `02_clustered_data.csv` – same cohort with an added `Cluster` column (0 = Mild, 1 = Moderate, 2 = Severe).
  - `cluster_descriptions.csv` – mapping from cluster IDs to clinical phenotype descriptions.
- `notebooks/`
  - `01_preprocessing.ipynb` – builds the analysis‑ready cohort (cohort selection, KNN imputation, QuantileTransformer) and saves `01_cleaned_advanced.csv`.
  - `02_pca_clustering.ipynb` – applies PCA (95% variance) and fits the final K‑Means model with `k=3`, saving `02_clustered_data.csv` and associated figures.
  - `03_validation.ipynb` – statistical and clinical validation of the three phenotypes (ICU admission, biomarker profiles, cluster descriptions).
  - `04_supervised_validation.ipynb` – Random Forest model that predicts the cluster labels from blood tests and analyses feature importance.
- `experiments/`
  - `01_ab_test_scaling.ipynb` – exploratory notebook comparing alternative preprocessing and scaling strategies on the raw cohort.
  - `02_clustering_model_selection.ipynb` – comparison of K‑Means, GMM and Hierarchical clustering across k=2..8 (Silhouette, BIC, dendrograms).
  - `03_clinical_screening_dump.ipynb` – global screening of all features using Chi‑Square and Kruskal–Wallis tests, producing `experiments/significance_ranking.csv`.
- `figures/` – publication‑quality figures generated by the notebooks (PCA plots, centroid heatmaps, ICU bar charts, biomarker boxplots, RF feature importances, etc.).
- `src/` – small helper module used by the notebooks:
  - `data_loader.py` – `ClinicalDataLoader` for reading the raw Excel/CSV and splitting metadata vs. lab features.
  - `features.py` – `ClinicalPreprocessor` implementing KNN imputation, QuantileTransformer and optional PCA.
  - `models.py` – `ClinicalClustering` wrapper around K‑Means and GMM.
  - `model_evaluation.py`, `visualization.py`, `visuals_data_richness.py` – plotting and evaluation utilities.
- `docs/Stage2_Paper_Draft.md` – draft of the final academic paper (Abstract, Introduction, Results, Methods, Discussion) based on the four core notebooks.

### 2. Setup and installation

1. Install Python 3.10+.
2. (Recommended) Create and activate a virtual environment.
3. From the project root, install the required packages:

```bash
pip install -r requirements.txt
```

The main third‑party dependencies are `pandas`, `numpy`, `scikit-learn`, `scipy`, `matplotlib`, `seaborn`, `joblib`, `jupyter` and `openpyxl` (for reading the Excel data).

### 3. Running the analysis

1. Launch Jupyter:

```bash
jupyter notebook
```

2. Execute the notebooks in order, from the project root:
   - `notebooks/01_preprocessing.ipynb`
   - `notebooks/02_pca_clustering.ipynb`
   - `notebooks/03_validation.ipynb`
   - `notebooks/04_supervised_validation.ipynb`

Each notebook is self‑contained and saves its outputs (processed CSV files and figures) into `data/processed/` and `figures/` respectively.

### 4. Reproducing the paper results

The quantitative results reported in `docs/Stage2_Paper_Draft.md` are obtained by running the four main notebooks plus the experimental notebooks under `experiments/`. In particular:

- The cohort sizes and missingness plots come from `01_preprocessing.ipynb`.
- The PCA and K‑Means clustering results (including centroid heatmaps) come from `02_pca_clustering.ipynb` and `experiments/02_clustering_model_selection.ipynb`.
- ICU admission rates and biomarker p‑values are computed in `03_validation.ipynb` using Chi‑Square and Kruskal–Wallis tests.
- The Random Forest performance metrics and feature importance plots are produced by `04_supervised_validation.ipynb`.

Running these notebooks end‑to‑end will regenerate all tables and figures referenced in the paper draft and in any presentation slides.
